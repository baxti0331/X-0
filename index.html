<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tik-Tak-Toe</title>
<style>
  body {
    margin: 0;
    padding: 20px;
    font-family: sans-serif;
    background: linear-gradient(to right, #6dd5fa, #2980b9);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    overflow: hidden;
  }
  #scoreboard {
    margin-bottom: 20px;
    font-size: 20px;
  }
  #board {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    gap: 10px;
  }
  .cell {
    width: 100px;
    height: 100px;
    background: white;
    color: black;
    font-size: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    cursor: pointer;
  }
  .cell.disabled {
    pointer-events: none;
    background-color: #ccc;
  }
  #message {
    margin-top: 20px;
    font-size: 24px;
  }
  canvas {
    position: fixed;
    top: 0;
    left: 0;
    pointer-events: none;
    width: 100vw;
    height: 100vh;
    z-index: 10;
  }
</style>
</head>
<body>

<div id="scoreboard">O'yinchi ‚ùå: 0 | Bot ‚≠ï: 0 | Durang: 0</div>
<div id="board"></div>
<div id="message">Navbat: ‚ùå</div>
<canvas id="fireworksCanvas"></canvas>

<script>
const boardElement = document.getElementById("board");
const messageElement = document.getElementById("message");
const scoreboardElement = document.getElementById("scoreboard");
const canvas = document.getElementById("fireworksCanvas");
const ctx = canvas.getContext("2d");

let board = Array(9).fill("");
let currentPlayer = "‚ùå";
let gameActive = true;
let playerWins = 0, botWins = 0, draws = 0;
let fireworks = [];
let animationId;

const winCombos = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

class FireworkParticle {
  constructor(x, y, color) {
    this.x = x;
    this.y = y;
    this.color = color;
    this.radius = Math.random() * 3 + 2;
    this.speedX = (Math.random() - 0.5) * 6;
    this.speedY = (Math.random() - 0.5) * 6;
    this.alpha = 1;
    this.gravity = 0.05;
    this.decay = 0.01 + Math.random() * 0.02;
  }
  update() {
    this.speedY += this.gravity;
    this.x += this.speedX;
    this.y += this.speedY;
    this.alpha -= this.decay;
  }
  draw() {
    ctx.save();
    ctx.globalAlpha = this.alpha;
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
  }
}

function createFireworks(x, y) {
  const colors = ["#ff4757", "#ffa502", "#1e90ff", "#2ed573", "#ff6b81", "#3742fa"];
  for (let i = 0; i < 60; i++) {
    const color = colors[Math.floor(Math.random() * colors.length)];
    fireworks.push(new FireworkParticle(x, y, color));
  }
}

function animateFireworks() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  fireworks.forEach(p => p.update());
  fireworks.forEach(p => p.draw());
  fireworks = fireworks.filter(p => p.alpha > 0);
  if (fireworks.length > 0) {
    animationId = requestAnimationFrame(animateFireworks);
  } else {
    cancelAnimationFrame(animationId);
  }
}

function showFireworks() {
  createFireworks(window.innerWidth / 2, window.innerHeight / 2);
  animateFireworks();
}

function drawBoard() {
  boardElement.innerHTML = "";
  board.forEach((cell, i) => {
    const div = document.createElement("div");
    div.className = "cell" + (cell ? " disabled" : "");
    div.textContent = cell;
    div.dataset.index = i;
    div.addEventListener("click", onCellClick);
    boardElement.appendChild(div);
  });
}

function onCellClick(e) {
  const i = +e.target.dataset.index;
  if (!gameActive || board[i] !== "") return;

  board[i] = currentPlayer;
  updateGame();

  if (gameActive && currentPlayer === "‚≠ï") {
    setTimeout(botMove, 500);
  }
}

function updateGame() {
  drawBoard();
  const winner = getWinner();

  if (winner) {
    messageElement.textContent = `G'olib: ${winner} üéâ`;
    gameActive = false;
    showFireworks();
    if (winner === "‚ùå") playerWins++;
    else botWins++;
    updateScore();
    setTimeout(resetGame, 2500);
  } else if (!board.includes("")) {
    messageElement.textContent = "Durang! ü§ù";
    draws++;
    updateScore();
    gameActive = false;
    setTimeout(resetGame, 2500);
  } else {
    currentPlayer = currentPlayer === "‚ùå" ? "‚≠ï" : "‚ùå";
    messageElement.textContent = `Navbat: ${currentPlayer}`;
  }
}

function getWinner() {
  for (const [a, b, c] of winCombos) {
    if (board[a] && board[a] === board[b] && board[a] === board[c]) {
      return board[a];
    }
  }
  return null;
}

function updateScore() {
  scoreboardElement.textContent = `O'yinchi ‚ùå: ${playerWins} | Bot ‚≠ï: ${botWins} | Durang: ${draws}`;
}

function resetGame() {
  board = Array(9).fill("");
  currentPlayer = "‚ùå";
  gameActive = true;
  messageElement.textContent = "Navbat: ‚ùå";
  drawBoard();
  fireworks = [];
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function botMove() {
  if (!gameActive) return;

  // 90% —É–º–Ω—ã–π —Ö–æ–¥
  if (Math.random() < 0.9) {
    // –ü–æ–±–µ–¥–∞
    for (const [a, b, c] of winCombos) {
      const line = [board[a], board[b], board[c]];
      if (line.filter(x => x === "‚≠ï").length === 2 && line.includes("")) {
        const move = [a, b, c][line.indexOf("")];
        board[move] = "‚≠ï";
        updateGame();
        return;
      }
    }

    // –ë–ª–æ–∫ –∏–≥—Ä–æ–∫–∞
    for (const [a, b, c] of winCombos) {
      const line = [board[a], board[b], board[c]];
      if (line.filter(x => x === "‚ùå").length === 2 && line.includes("")) {
        const move = [a, b, c][line.indexOf("")];
        board[move] = "‚≠ï";
        updateGame();
        return;
      }
    }

    // –¶–µ–Ω—Ç—Ä
    if (board[4] === "") {
      board[4] = "‚≠ï";
      updateGame();
      return;
    }

    // –£–≥–æ–ª
    const corners = [0, 2, 6, 8].filter(i => board[i] === "");
    if (corners.length) {
      const move = corners[Math.floor(Math.random() * corners.length)];
      board[move] = "‚≠ï";
      updateGame();
      return;
    }
  }

  // –°–ª—É—á–∞–π–Ω—ã–π
  const empty = board.map((v, i) => v === "" ? i : null).filter(v => v !== null);
  const move = empty[Math.floor(Math.random() * empty.length)];
  board[move] = "‚≠ï";
  updateGame();
}

drawBoard();
</script>
</body>
</html>